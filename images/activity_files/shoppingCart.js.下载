var frontcolor=0,xuansize="",xuanclo="",firstImg="",firstPrice="",firstId="",firstSize="",colhtml="",istemai=!1;eval(function(t,s,a,i,e,o){if(e=function(t){return t.toString(s)},!"".replace(/^/,String)){for(;a--;)o[e(a)]=i[a]||e(a);i=[function(t){return o[t]}],e=function(){return"\\w+"},a=1}for(;a--;)i[a]&&(t=t.replace(new RegExp("\\b"+e(a)+"\\b","g"),i[a]));return t}("n m(d,e,f){f=f||0;2 g='',6=+e.5(-1),e=e.5(6,e.j);2 a,b,c;3(!f){a=7,b=8,c=o}4{a=8,b=k,c=7}l(2 i=0,9=d.j;i<9;i++){2 h=e.p(d[i]);3(h===a){g+='.'}4 3(h===b||h===c){g+='0'}4{g+=h}}q g}",27,27,"||var|if|else|slice|x|13|12|len||||||||||length|11|for|sm|function|14|indexOf|return".split("|"),0,{})),function(t){function s(t){var s=(new a,""),i="",e="",o="",n="",c=[],r=!0;$.each(t,function(a,p){var l=0,d=1;$.each(t[a].sizes,function(t,s){"f"==s&&(d=1)}),0==t[a].status&&(l=2),2==t[a].status&&2==t[a].o_s&&(l=3),c.push("<li"+(r?' class="status-checked-2"':"")+' data-color="'+a+'" data-status="'+l+'" data-stock="'+d+'"><span class="pop_sizetext">'+t[a].code_color+"</span> <i></i></li>"),r=!1,"undefined"!=typeof t[a].price&&(t[a].price=t[a].sign?sm(t[a].price,t[a].sign):t[a].price,t[a].m_price=t[a].sign?sm(t[a].m_price,t[a].sign,1):t[a].price),colhtml=n=c.join(""),s||(firstImg=s=t[a].item_pic),i||(firstPrice=i=t[a].price,xuanclo=t[a].code_color),o||(firstSize=o=t[a].sizes),e||(firstId=e=istemai?"t2":t[a].id)})}function a(t){this.opts=$.extend({},i,t),this.evts=$("."+this.opts.eventClass),this.statusPop=$('<div id="cart_pop_status" class="popHint hide"><i></i><p></p></div>').appendTo(document.body),this.maskPop=$('<div id="cart_pop_mask" class="popMask"></div>').appendTo(document.body),this.cartPop=$('<div id="cart_pop_cart" class="popCart"></div>').appendTo(document.body),this.sizeStr='<span class="pop_sizetext" data-size="{0}">{0}</span><i></i>',this.disbtn=this.opts.disabledClass,this.tempBtn=null,this.init()}String.prototype.format=function(t){if(arguments.length>0){var s=this;if(1==arguments.length&&"object"==typeof t)for(var a in t){var i=new RegExp("({"+a+"})","g");s=s.replace(i,t[a])}else for(var e=0;e<arguments.length;e++){if(void 0==arguments[e])return"";var i=new RegExp("({["+e+"]})","g");s=s.replace(i,arguments[e])}return s}return this};var i={device:"pc",eventClass:"addShoppingCart",parentClass:"defaultBlock",disabledClass:"com_cartbtn_disabled"};a.prototype={init:function(){var t=this;$("body").on("click","."+this.opts.eventClass,function(){var a=$(this);if(!a.hasClass(t.disbtn)){a.addClass(t.disbtn);var i=a.attr("data-sku-sz")||a.attr("data-sku")||a.attr("data-other1"),e=a.parents("."+t.opts.parentClass).attr("data-sku-sz")||a.parents("."+t.opts.parentClass).attr("data-sku")||a.parents("."+t.opts.parentClass).attr("data-other1"),o=i?i:e,n={count:1,size:"",id:o};console.log(n);var c=a.attr("data-cluster"),r=a.parents("."+t.opts.parentClass).attr("data-cluster"),p=c?c:r;return frontcolor=p?1:0,1==frontcolor?($("#cart_pop_cart").html('<div class="othlist"><img class="popImg" src="" alt="" /><span class="popPrice"></span><span class="cart_pop_check"></span></div><h5>可选</h5><ul class="sizelist color_l"></ul><h5>规格</h5><ul class="sizelist size_l"></ul><a href="javascript:;" class="btn-add">加入购物车</a>'),$.ajax({url:"/search/getClusterItemInfos",cache:!1,dataType:"json",data:{cluster_ids:p},type:"POST",success:function(i){s(i),t.loadFSizePop(firstSize,o),t.maskPop.show(),t.tempBtn=a,$(".color_l").on("click","li",function(){var s=$(this),a=$(this).data("color"),e=i[a];return!s.hasClass("status-none")&&(s.addClass("status-checked-2").siblings().removeClass("status-checked-2"),firstImg=e.item_pic,firstPrice=e.price,firstSize=e.sizes,firstId=e.id,t.loadFSizePop(firstSize,o),xuanclo=e.code_color,$(".popImg").attr("src",firstImg),$(".popPrice").html("¥"+firstPrice),void $(".cart_pop_check").html("已选“"+xuanclo+" "+xuansize+"”"))}),$(".size_l").on("click","li",function(){var t=$(this);return xuansize=t.find(".pop_sizetext").text(),!t.hasClass("status-none")&&(t.addClass("status-checked").siblings().removeClass("status-checked"),void $(".cart_pop_check").html("已选“"+xuanclo+" "+xuansize+"”"))}),$(".color_l").html(colhtml),$(".popImg").attr("src",firstImg),$(".popPrice").html("¥"+firstPrice),$(".cart_pop_check").html("已选“"+xuanclo+" "+xuansize+"”")}})):($("#cart_pop_cart").html('<h5>请选择商品规格</h5><ul class="sizelist size_l"></ul><a href="javascript:;" class="btn-add">加入购物车</a>'),t.doCartAjax(n,a)),!1}}),this.maskPop.on("click",function(s){t.hideCartPop(t.tempBtn),t.maskPop.hide()}),this.cartPop.on("click","li",function(){var t=$(this);return!t.hasClass("status-none")&&void(t.hasClass("status-checked-2")?t.addClass("status-checked-2").siblings().removeClass("status-checked-2"):t.addClass("status-checked").siblings().removeClass("status-checked"))}),this.cartPop.on("click",".btn-add",function(){if(1==frontcolor){var s=t.cartPop.find(".status-checked-2"),a=s.data("status"),i=s.data("stock"),e="";if(0==i&&(e="啊 库存不足啦~"),2==a&&(e="啊 库存不足啦~"),3==a&&(e="特卖还没开始哦"),""!=e||e)return t.changeStatusPop("warn",e),t.hideCartPop(t.tempBtn),t.maskPop.hide(),!1;var o=firstId;"默认"==n&&(n="SINGLE")}else var o=t.cartPop.attr("data-sku");var n=t.cartPop.find(".status-checked"+("app"==t.opts.device?"":" .pop_sizetext")).text(),c={count:1,size:n,id:o};t.hideCartPop(),t.maskPop.hide(),t.doCartAjax(c,t.tempBtn)}),this.statusPop.on("click",function(){t.hideStatusPop(!1,t.tempBtn)})},isApp:function(){var s=t.location.href,a=s.indexOf("_app");return navigator.userAgent.indexOf("miyabaobei_")>-1||a!==-1},getTongji:function(s){var a=2017,i={skuid:s.id};i=encodeURIComponent(JSON.stringify(i)),t.location.href="miyabaobei://h5logevent?event_id="+a+"&real_time="+!0+"&params="+i},changeStatusPop:function(t,s){switch("app"!=this.opts.device&&this.statusPop.css({opacity:1,height:"136px",width:"248px",top:"50%",left:"50%"}),t){case"loading":this.statusPop.attr("class","popHint cartloading").find("p").html("loading...");break;case"error":this.statusPop.attr("class","popHint error").find("p").html("加购物车失败");break;case"success":this.statusPop.attr("class","popHint success").find("p").html("已加入购物车");break;case"warn":this.statusPop.attr("class","popHint error").find("p").html(s);break;case"hide":this.statusPop.attr("class","popHint hide");break;default:this.statusPop.attr("class","popHint hide")}},loadSizePop:function(t,s){var a=this;if(this.changeStatusPop("hide"),!t)return!1;this.cartPop.find(".size_l").html("");var i="",e=[],o=!0;$.each(t,function(t,s){0==s?e.push('<li class="status-none">'+a.sizeStr.format(t)+"</li>"):(e.push("<li"+(o?' class="status-checked"':"")+">"+a.sizeStr.format(t)+"</li>"),o=!1)}),i=e.join(""),this.cartPop.addClass("popShow").attr("data-sku",s).find(".size_l").append(i),"app"!=this.opts.device&&this.cartPop.css({"margin-top":-this.cartPop.height()/2}),this.maskPop.addClass("popmaskShow")},loadFSizePop:function(t,s){var a=this;if(this.changeStatusPop("hide"),!t)return!1;this.cartPop.find(".size_l").html("");var i="",e=[],o=!0;$.each(t,function(t,s){"SINGLE"==t?t="默认":""==t&&(t="无规格"),0==s?e.push('<li class="status-none">'+a.sizeStr.format(t)+"</li>"):(e.push("<li"+(o?' class="status-checked"':"")+">"+a.sizeStr.format(t)+"</li>"),o&&(xuansize=t),o=!1)}),i=e.join(""),this.cartPop.addClass("popShow").attr("data-sku",s).find(".size_l").append(i),"app"!=this.opts.device&&this.cartPop.css({"margin-top":-this.cartPop.height()/2}),this.maskPop.addClass("popmaskShow")},hideCartPop:function(t){t&&t.removeClass(this.disbtn),this.cartPop.removeClass("popShow"),this.maskPop.removeClass("popmaskShow")},hideStatusPop:function(t,s){s&&s.removeClass(this.disbtn);var a=this;"app"!=this.opts.device&&t?this.statusPop.animate({top:"0",left:"98%",width:0,height:0},300,function(){a.changeStatusPop("hide")}):this.changeStatusPop("hide")},doCartAjax:function(s,a){var i=this,e=null,o=null;i.tempBtn=a,navigator.userAgent.indexOf("miyabaobei_")>-1&&("undefined"!=typeof suserid&&suserid&&"undefined"!=typeof ssessionid&&ssessionid&&(s.userid=suserid,s.sessionid=ssessionid),s.is_app=1);var n="52";e&&e.abort(),clearTimeout(o),o=setTimeout(function(){e=$.ajax({url:"/instant/cart/addToCartDirect",cache:!1,dataType:"json",data:s,type:"POST",beforeSend:function(){i.changeStatusPop("loading")},success:function(e){if(1==e.code)i.changeStatusPop("success"),setTimeout(function(){i.hideStatusPop.call(i,!0,a),"function"==typeof ajaxReq&&ajaxReq(e),i.isApp()&&i.getTongji(s),_tag.dcsMultiTrack("wt.pid",s.id,"wt.nu",s.count,"wt.dl",n)},800);else if(5==e.code)setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800),t.location.href="miyabaobei://login";else if(4==e.code)n="54",setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800),s.is_app?t.location.href="miyabaobei://productDetail?id="+s.id:t.location.href="/order/index/direct",_tag.dcsMultiTrack("wt.pid",s.id,"wt.nu",s.count,"wt.dl",n);else if(e.code==-2){if(n="54",setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800),s.is_app)t.location.href="miyabaobei://login";else{var o=encodeURIComponent(t.location.href.replace(/^#.*?/gm,""));t.location.href="/login?url="+o}_tag.dcsMultiTrack("wt.pid",s.id,"wt.nu",s.count,"wt.dl",n)}else e.code==-1?e.size_lists?(i.maskPop.show(),i.tempBtn=a,i.loadSizePop(e.size_lists,s.id)):(setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800),i.isApp()?t.location.href="miyabaobei://productDetail?id="+s.id:console.log(e.msg)):(i.changeStatusPop("error"),setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800))},error:function(){i.changeStatusPop("error"),setTimeout(function(){i.hideStatusPop.call(i,!1,a)},800)},complete:function(){}})},200)}},t.comAddToCart=a}(window),function(){var t=window.location.href.indexOf("m.mia.com")>-1||window.location.href.indexOf("m.miyabaobei.com")>-1?"app":"pc";new comAddToCart({device:t})}();