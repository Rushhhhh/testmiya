function NewItemInfo(e){this.opt=e?e:"",this.init()}NewItemInfo.prototype={init:function(){var e=this,o=$("#item_id").val();$.ajax({url:"https://p.mia.com/item/base/"+o,dataType:"jsonp",timeout:1e4,jsonp:"callback",jsonpCallback:"success_jsonpCallback",success:function(o){if($.isEmptyObject(o))oldIteminfo();else{var t=e.format(o,e);ajaxItemInfo(t),e.opt.fn&&e.opt.fn(o)}},error:function(){oldIteminfo()}})},format:function(e,o){if(!e)return!1;var t={curtime:o.formatDate(new Date),o_s:"",outlets_time:"",discount:parseFloat(e.sp/e.mp*10).toFixed(1),s:0},s=[40,296,9,24,94,688,2973,620,621,622,1897,2960],a={oSale:!1,oSaleTom:!1,is_promotion:0,o_s_s:0},i=+new Date,n=!1;if(t.price=e.sp?parseFloat(e.sp).toFixed(2):-1,t.m_price=e.mp?parseFloat(e.mp).toFixed(2):-1,e.opst&&(a.is_promotion=i>=+new Date(e.opst)&&i<=+new Date(e.opet)?1:0),e.o_l&&e.o_l.length>0&&$.each(e.o_l,function(e,o){+new Date(o.s)<=i&&i<=+new Date(o.e)?(a.oSale||(a.oSale=o),a.oSaleTom||(a.oSaleTom=o)):i<+new Date(o.s)&&(a.oSaleTom||(a.oSaleTom=o))}),!a.oSale&&a.oSaleTom&&(a.oSale=a.oSaleTom),0==e.is_o?a.o_s_s=1:1==e.is_o&&(a.oSale?+new Date(a.oSale.s)>i?a.is_promotion&&(a.o_s_s=1):a.o_s_s=1:s.indexOf(e.w_i)!=-1&&(a.o_s_s=1)),a.oSale?(t.o_s=1,t.outlets_time=a.oSale.e):a.oSaleTom?(a.is_promotion&&i<+new Date(a.oSaleTom.s)&&(a.oSaleTom.s=o.formatDate(new Date)),i>=+new Date(a.oSaleTom.s)&&i<=+new Date(a.oSaleTom.e)?(t.o_s=1,t.outlets_time=a.oSaleTom.e):i<+new Date(a.oSaleTom.s)?(t.o_s=2,t.outlets_time=a.oSaleTom.s):t.o_s=3):a.o_s_s?t.o_s=4:t.o_s=0,e.i_s&&e.i_s.hasOwnProperty("SINGLE")&&1==o.jsonLength(e.i_s))t.sizes="SINGLE",e.i_s.SINGLE>0&&(n=!0);else{t.sizes=e.i_s;for(key in t.sizes)t.sizes[key]>0&&(n=!0),t.sizes[key]>5&&(t.sizes[key]="f")}return e.i_s&&e.i_s.hasOwnProperty("SINGLE")&&n&&(t.s="f"),1==e.s&&n?(a.o_s_s?t.status=1:t.status=0,e.is_o||(t.status=2)):t.status=0,e.isp&&1==e.s&&n&&(t.status=5),t},formatDate:function(e){var o=new Date(e),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=o.getFullYear(),a=o.getMonth(),i=o.getDate(),n=o.getHours(),l=o.getMinutes(),_=o.getSeconds();return i=i<10?"0"+i:i,n=n<10?"0"+n:n,l=l<10?"0"+l:l,_=_<10?"0"+_:_,t[a]+" "+i+" "+s+" "+n+":"+l+":"+_},jsonLength:function(e){var o=0;for(var t in e)o++;return o}};