function doLogin(){if(checkLoginForm()&&checkAuthCode()){var e=$("#url").val();""!=e&&"undefined"!=typeof e||(e="/"),$.ajax({type:"POST",url:"/instant/account/loginService",dataType:"json",data:$("#login_form").serialize(),success:function(t){if(1==t.code){if(t.synlogin)for($i=0;$i<t.synlogin.length;$i++){var o=document.createElement("iframe");o.style.display="none",o.id="ssoifrm",o.src=""+t.synlogin[$i],document.body.appendChild(o)}setTimeout(function(){window.location.href=e},7e3);var n=document.getElementById("ssoifrm");n.onload=function(){window.location.href=e}}else{$("#login_verified_code").attr("src","/account/login/authcode/"+Math.random()),$(".loginNotice").empty().hide();var i=$(".loginErrorNotice");"验证码错误"==t.msg?i.eq(1).text(t.msg).show():t.msg.indexOf("短信验证码")!=-1?i.eq(2).text(t.msg).show():i.eq(0).text(t.msg).show(),1==t.login_level_status&&($("#verityGroup").attr("data-hidden",0).show(),$(".formLine").css("margin-top","45px"))}}})}}function checkAuthCode(){if(1==$("#verityGroup").attr("data-hidden"))return!0;var e=$.trim($("#authcode").val()),t=/^[0-9a-zA-Z]{4,6}$/;return!(""==e||!t.test(e))||($(".loginErrorNotice.cd").text("验证码错误").show(),!1)}function checkLoginForm(){return $.bt_validate.result=!0,$.bt_validate.form.find("input[validate],select[validate],textarea[validate]").trigger("blur"),!$.bt_validate.blocked&&$.bt_validate.result}function sendMessageLogin(e){curCount=count;for(var t=$("#authcode").val(),o=$(".tipauthcode"),n=$(".tipauthcode .tipcon"),i=0;i<codeLength;i++)code+=parseInt(9*Math.random()).toString();$.ajax({type:"POST",dataType:"json",url:"/instant/account/getMobileVerifyCodeLogin",data:"code="+code+"&cell="+e+"&authcode="+t,success:function(e){var t="";2==e.code?(o.show(),n.text(e.msg).show(),$("#login_verified_code").attr("src","/account/login/authcode")):1==e.code?($("#sendVerifyCodeLogin").text(curCount+"秒后重新获取"),is_click=1,InterValObj=window.setInterval(SetRemainTime,1e3),t="tipmessagebg",$("#sendVerifyCodeLogin").parent().parent().children("p").removeClass("usermassge1").addClass("usermassge").html(getTipHtml(e.msg,t)).show(),window.setTimeout(function(){$(".usermassge").hide()},1e3)):(window.clearInterval(InterValObj),$("#sendVerifyCodeLogin").text("重新发送短信验证码"),is_click=0,$("#login_username").parent().parent().find(".loginErrorNotice").html(getTipHtml(e.msg,t)).show())}})}function SetRemainTime(){0==curCount?(window.clearInterval(InterValObj),$("#sendVerifyCodeLogin").text("重新发送短信验证码"),is_click=0,code=""):(curCount--,$("#sendVerifyCodeLogin").text(curCount+"秒后重新获取"))}function getTipHtml(e,t){var o="tipnamebg";t&&(o=t);var n='<span  class="tipcon">'+e+"</span>";return n+='<span class="rownotice"><img src="/resources/images/'+o+'.png"></span>'}$("#login_form").bt_validate(),$(document).ready(function(){$("#login_submit").click(function(){return doLogin(),!1}),$("#authcode").focus(function(){$(".authcode").hide()}),$("#phonecode").focus(function(){$(".mb").hide()}),$("#login_verified_code,#login_verified_refresh").click(function(e){e.preventDefault(),$("#login_verified_code").attr("src","/account/login/authcode/"+Math.random())}),$(window).keydown(function(e){switch(e.keyCode){case 13:doLogin()}})});var InterValObj,count=60,curCount,code="",codeLength=4,is_click=0;$("#sendVerifyCodeLogin").bind("click",function(e){if(console.log(111),1==is_click)return!1;e.preventDefault();var t=$("#login_username"),o=$.trim(t.val());if(!/^((13[0-9])|(15[0-9])|(14[5-7])|(166)|(17[0-9])|(18[0-9])|(19[0-9]))\d{8}$/.test(o)){var n="请输入正确的手机号码，且为11位纯数字格式";return t.parent().parent().find(".loginErrorNotice").html(getTipHtml(n,"")).show(),!1}if(1!=$("#verityGroup").attr("data-hidden")){var i=$("#authcode").val();if(!i)return $(".tipauthcode").show(),$(".tipauthcode .tipcon").text("验证码不能为空").show(),!1}sendMessageLogin(o)});