function scrollwrap(t){var e=$("#cdspscroll"),i=e.find("li").length,a=e.data("current")||1,o=parseInt(e.css("left"));if("left"==t){if(1==a)return;a-=4,o=o<-960?o+960:0,e.css("left",o+"px"),a=a<1?1:a,e.data("current",a)}else{if(a==i-4)return;a+=4,(a>i-4||a==i-4)&&(a=i-4),e.css("left",o-960+"px"),e.data("current",a)}}function showGiftPop(t){var e={init:function(){this.$mask=$(".popBg"),this.$content=$("#pop_gift")},show:function(){this.$mask.show();var t=this.$content.width(),e=this.$content.height();this.$content.css({"margin-top":-e/2+"px","margin-left":-t/2+"px"}).show()},hide:function(){this.$mask.hide(),this.$content.hide()},setTxt:function(t){this.$content.find(".pop_txt").text(t)}};e.init(),e.setTxt(t),e.show()}function formSubmit(t){var e=[];if($('input[name="productcheck"]').each(function(){$(this).prop("checked")&&e.push($(this).val())}),e.length<1)return cartTips(t,"err","请选择要结算的商品"),!1;var i=2e3;$.ajax({url:"/instant/cart/saveCartContents",cache:!1,type:"POST",dataType:"json",data:{submit:1,from:"pc"},beforeSend:function(){var t=$(".btnJieSuan");t.hide(),$(".btnJieSuan").parent().append('<span id="submitloading" class="submitloading" style="float:right;height:59px;width:98px;font-size: 19.5px;">结算中</span>')},success:function(e){switch(popNotShow=0,$(".btnJieSuan").show(),$(".submitloading").remove(),e.code){case 2:window.location.href="/login?url=/cart";break;case 0:if(44001==e.ecode){var a={tit:"蜜芽提示",txt:e.msg,btn_go:"去结算",btn_quxiao:!0};popCart_oth(a)}else 22010==e.ecode||22009==e.ecode?showGiftPop(e.msg):(cartTips(t,"err",e.msg),setTimeout(function(){},i));break;case 3:$(".popCart_name,.popBg").show();break;case 4:cartTips(t,"err",e.msg),setTimeout(function(){window.location.href="/dutyfree.html"},i);break;case-3:changeTotal(t),cartTips(t,"err",e.msg),setTimeout(function(){window.location.reload()},i);break;case 1:window.location.href="/order";break;default:cartTips(t,"err",e.msg)}}})}function changePromotion(t,e){var i=$("div.cl_con[data-pid="+t.opid+"]").find(".cl_tag").length;0==i?(getNoPromotionItemNum(),changeTotal(e)):$.ajax({url:"/instant/cart/checkPromotions",type:"POST",dataType:"json",data:t,success:function(t){if(1==t.code){if(1!=t.active){var i=$("div.cl_con[data-pid="+t.pid+"]");i.find(".cl_tag").addClass("disabled_h"),i.find(".cl_words em").html("(还差"+t.diff+"元满足活动条件)"),i.find("div[data-gift="+t.pid+"]").remove(),$("#shopping_cart div[data-fpid="+t.pid+"]").remove()}else{var i=$("div.cl_con[data-pid="+t.pid+"]");i.find(".cl_tag").removeClass("disabled_h"),i.find(".cl_words span").remove(),1==t.gift&&0==i.find("div[data-gift="+t.pid+"]").length&&(html='<div data-gift="'+t.pid+'"><a href="javascript:;" class="btn_xzzp selectBonus">选择赠品<i></i></a></div>',i.find(".cl_tit").append(html)),2==t.gift&&(i.find(".cl_mck .mck").prop("checked")?(i.find(".cl_tag").removeClass("disabled_h"),0==i.find("div[data-gift="+t.pid+"]").length&&(html='<div data-gift="'+t.pid+'"><a href="javascript:;" class="btn_xzzp selectBonus">选择赠品<i></i></a></div>',i.find(".cl_tit").append(html))):(i.find(".cl_tag").addClass("disabled_h"),i.find("div[data-gift="+t.pid+"]").remove()))}changeTotal(e)}else cartTips(e,"err",t.msg)}})}function addPromotionInfo(t){makePromotion(t)}function makePromotion(t){var e=$("#myShopPromotionArea .rim .l");if(th=$("thead[data-pid="+t.pid+"]"),0!=t.pid)if(1==t.active){th.find(".diff").remove(),0==e.find("p").length&&e.html("<h6>已参与优惠活动</h6>");var i;switch(t.gift){case 0:0==e.find("p").filter('[data-pid="'+t.pid+'"]').length&&(i='<p data-pid="'+t.pid+'">'+t.pname+"</p>");break;case 1:0==e.find("p").filter('[data-pid="'+t.pid+'"]').length&&(i='<p data-pid="'+t.pid+'">'+t.pname+'<a href="#" class="selectBonus">选赠品</a></p>');break;case 2:0==e.find("p").filter('[data-rowid="'+t.row_id+'"]').length&&void 0!=t.row_id&&(i='<p data-pid="'+t.pid+'" data-rowid="'+t.row_id+'">'+t.pname+'<a href="#" class="selectBonus">选赠品</a></p>')}e.append(i)}else th.find(".promico").addClass("noEnough"),"undefined"!=typeof t.diff&&0!=t.diff&&(th.find(".txt .diff").remove(),th.find(".txt").append('<span class="diff">(还差'+t.diff+"元满足活动条件)</span>")),$("#myShopPromotionArea p[data-pid="+t.pid+"]").remove()}function stockOver(t){$("#dialog").html(t),$("#dialog").dialog({autoOpen:!0,closeOnEscape:!0,modal:!0,width:740,position:"center"}).dialog("open")}function ajaxLogin(t){$.ajax({url:"/login/fast_login?jumpurl="+t,success:function(t){$("select.actionlist").hide(),$("#dialog").html(t),$("#dialog").dialog({autoOpen:!0,closeOnEscape:!0,modal:!0,width:720,position:"center"}).dialog("open")}})}function addToCart(t,e){var i=!0;if(""!=t&&"undefined"!=typeof t||(i=!1,cartTips(e,"err","请刷新重试")),i){var a={count:1,size:"SINGLE",id:t};_tag.dcsMultiTrack("wt.pid",t,"wt.nu",1,"wt.dl","53"),$.ajax({url:"/instant/cart/addToCartDirect",cache:!1,dataType:"json",data:a,type:"POST",beforeSend:function(){$(e.target).css({visibility:"hidden"}).before('<img src="/resources/images/ajax-loader.gif" class="loadimg" style="float:left;left:50px;position:relative;top:5px;">')},success:function(t){setTimeout(function(){$(e.target).css({visibility:"visible"}),$(".loadimg").remove()},800),cartRelated(e,t,a),window.location.reload()}})}}function cartRelated(t,e,i){var a=$(t.target),o={left:a.offset().left,top:a.position().top,parent:a.parent(),_html:e.msg};e.code>0?($("<div />").addClass("addCartOk").css({top:o.top,left:o.left-o.parent.offset().left}).html("已加入购物车").appendTo(o.parent).delay(1200).animate({opacity:0,left:"+=250",top:"-=450"},300,function(){$(this).remove(),ajaxReq()}),_tag.dcsMultiTrack("wt.pid",i.id,"wt.nu",i.count,"wt.dl","52")):$("<div />").addClass("addCartErr").css({top:o.top-10,left:o.left}).html("请刷新重试").appendTo(o.parent).delay(1e3).animate({opacity:0},500,function(){$(this).remove()})}function changeSelect(t,e){$.ajax({url:"/instant/cart/changeSelect",type:"POST",dataType:"json",data:t,success:function(i){0==i.code?changePromotion(t,e):cartTips(e,"err",i.msg)}})}function batchChangeSelect(t,e){$.ajax({url:"/instant/cart/changeSelect",type:"POST",dataType:"json",data:t,success:function(i){0==i.code?batchChangePromotion(t,e):cartTips(e,"err",i.msg)}})}function getNoPromotionItemNum(){var t=0;$("#shopping_cart .cl_con[data-pid=0] .it_mck .mck").each(function(){t+=parseInt($(this).parents(".it_mck").siblings(".it_num").find(".dp_num").val())}),$("#shopping_cart .cl_con[data-pid=0] .cl_words span").text(t)}function batchChangePromotion(t,e){"undefined"==typeof t.opid||""==t.opid?(getNoPromotionItemNum(),changeTotal(e)):$.ajax({url:"/instant/cart/batchCheckPromotions",type:"POST",dataType:"json",data:t,success:function(t){if(1==t.code){for(i=0;i<t.data.length;i++)if(data=t.data[i],1!=data.active){var a=$("div.cl_con[data-pid="+data.pid+"]");a.find(".cl_tag").addClass("disabled"),a.find(".cl_words span").remove(),a.find("div[data-gift="+data.pid+"]").remove()}else{var a=$("div.cl_con[data-pid="+data.pid+"]");a.find(".cl_tag").removeClass("disabled"),a.find(".cl_words span").remove(),1==data.gift&&0==a.find("div[data-gift="+data.pid+"]").length&&(html='<div data-gift="'+data.pid+'"><a href="javascript:;" class="btn_xzzp selectBonus">选择赠品<i></i></a></div>',a.find(".cl_tit").append(html)),2==data.gift&&(a.find(".cl_mck .mck").prop("checked")?(a.find(".cl_tag").removeClass("disabled"),0==a.find("div[data-gift="+data.pid+"]").length&&(html='<div data-gift="'+data.pid+'"><a href="javascript:;" class="btn_xzzp selectBonus">选择赠品<i></i></a></div>',a.find(".cl_tit").append(html))):(a.find(".cl_tag").addClass("disabled"),a.find("div[data-gift="+data.pid+"]").remove()))}getNoPromotionItemNum(),changeTotal(e)}else cartTips(e,"err",t.msg)}}),getNoPromotionItemNum()}function changeNum(t,e,i){var a=null,o=t.attr("class");a="dp_jian"==o?t:"dp_jia"==o?t.prev().prev():t.prev(),$.ajax({url:"/instant/cart/addToCart",type:"POST",dataType:"json",data:e,async:!1,success:function(o){var n=t;if(1==o.code){t.val(e.num);var s=t.attr("rowid");$(".rowid-"+s).each(function(){var t=$(this),i=t.find(".spuitem_num");i.text(i.data("qty")*e.num)}),parseInt(e.num)<=1?a.addClass("disabled"):a.removeClass("disabled"),cartTips(i,"success","数量修改成功"),n.data("ori")&&n.data("ori",e.num),t.closest(".gooditem").find(".subTotal .item_fee").text("￥"+o.subtotal).attr("data-fee",o.subtotal);t.closest(".gooditem").find(".midou_dikou");changePromotion(e,i)}else cartTips(i,"err",o.msg),n.data("ori")&&n.val(n.data("ori"))}})}function partDelete(t){$.ajax({url:"/instant/cart/removeItems",type:"POST",dataType:"json",data:{row_id:t.rowid},success:function(e){switch(e.code){case 0:for(var i=0;i<t.rowid.length;i++){var a=$("#shopping_cart input[value="+t.rowid[i]+"]").closest(".gooditem"),o=a.parents(".cl_con"),n=a.parents(".cl_promotion"),s=o.data("pid");_btmtop-=a.outerHeight(!0),a.remove(),0==n.find(".gooditem").length&&(_btmtop-=o.outerHeight(!0),n.remove()),0==o.find(".gooditem").length&&(_btmtop-=o.outerHeight(!0),o.parent().remove(),$("#shopping_cart .c_list").eq(0).css("margin-top","0px"))}changeBtmFixed(),$("#shopping_cart .gooditem").length<1&&window.location.reload();var d=($(t.target).closest("td"),{opid:s||0,row_id:t.rowid});changePromotion(d,t.target);break;default:cartTips(t.target,"err",e.msg)}}})}function formatUndefined(t){return"undefined"==typeof t&&(t=""),t}function concatParenttheses(t){var e=0;return e?"("+t+")":t}function changeTotal(t){var e=0,i={row_id:[]};$("#shopping_cart input[name=productcheck]").each(function(){$(this).prop("checked")&&(i.row_id[e]=$(this).val(),e++)});var a=!0,o="/instant/cart/getTotal";$.ajax({url:o,type:"POST",data:i,dataType:"json",async:!1,beforeSend:function(){return 1==a&&(a=!1,!0)},success:function(t){if(1==t.code){var i=t.cartData;$(".newCart_select_quantity").text(i.cart_total.select_quantity),$(".newCart_settle_amount").text("¥"+i.cart_total.settle_amount);var a=$(".newCart"),o=a.find(".thrift_price"),n=0,s=a.find(".taxes_price"),d=a.find(".dot"),r=a.find(".bracket");i.cart_total.thrift_price?(n++,o.text("已减：￥"+i.cart_total.thrift_price),o.show()):o.hide(),i.cart_total.taxes_price?(n++,s.text(i.cart_total.tax_name+"：￥"+i.cart_total.taxes_price),s.show()):s.hide(),n>0?r.show():r.hide(),n>1?d.show():d.hide();var c=t.cartData.row_infos;return $.each(c,function(t,a){var o=$(".store_"+a.store_id),n=a.item_group;if(n.length>0)for(e=0;e<a.item_group.length;e++){var s=a.item_group[e].items,d=n[e].promotion;if(s)for(var r=0;r<s.length;r++){var c=o.find(".gooditems_"+s[r].id+" .midou_dikou"),l=s[r].item_quantity;if(0==s[r].offset_status)c.hide();else if(1==s[r].offset_status){var p='<span class="ts1">蜜豆抵扣</span>可用<span class="mid_mid">'+s[r].offset_info.exchange_mibean*l+'</span>蜜豆抵扣<span class="mid_rmb">'+(s[r].offset_info.exchange_price*l).toFixed(2)+"</span>元";c.find(".tp1").html(p),c.show()}else if(2==s[r].offset_status){var f='<span class="ts1">蜜豆抵扣</span><span class="mid_mid">'+s[r].offset_info.exchange_mibean*l+'</span>蜜豆已抵扣<span class="mid_rmb">'+(s[r].offset_info.exchange_price*l).toFixed(2)+"</span>元";c.find(".tp1").html(f),c.show()}var m=o.find(".gooditems_"+s[r].id+" .tax");m.length>0&&(s[r].taxes_price?m.text(i.cart_total.tax_name+"¥"+s[r].taxes_price):m.text(""));var u=!1;"undefined"!=typeof d&&null!=d&&d.is_valid&&(u=!0);var _=s[r].item_message;_&&u?o.find(".gooditems_"+s[r].id+" .limit_buy").text(_[0].content):o.find(".gooditems_"+s[r].id+" .limit_buy").text(""),2!=s[r].buy_type&&3!=s[r].buy_type||(o.find(".gooditems_"+s[r].id+" .goodsp").text("¥"+s[r].item_sale_price),o.find(".gooditems_"+s[r].id+" .goodsp").attr("data-goodsp",s[r].item_sale_price),o.find(".gooditems_"+s[r].id+" .item_fee").text("¥"+1e4*s[r].item_sale_price*s[r].item_quantity/1e4),o.find(".gooditems_"+s[r].id+" .item_fee").attr("data-fee",1e4*s[r].item_sale_price*s[r].item_quantity/1e4),s[r].item_seckill_show?o.find(".gooditems_"+s[r].id+" .seckill_limit").show():o.find(".gooditems_"+s[r].id+" .seckill_limit").hide())}if("undefined"!=typeof a.item_group[e].promotion&&null!=d){var d=a.item_group[e].promotion,h=d.id,g=o.find('div[data-promotion="'+h+'"]'),v=g.find(".cl_tag").attr("data-promotion_type");if(!d.seleted_gift||"normal_gift"!=v&&"full_gift"!=v&&"ladder_full_gift"!=v||(g.find(".cl_words span.full_diff_money").hide(),g.find(".cl_words > a").hide()),"normal_gift"==v||"full_gift"==v||"ladder_full_gift"==v){g.find(".cl_words_zp").remove();var w=n[e].promotion.gift_lists,b="";if(w&&w.length>0)for(r=0;r<w.length;r++)1==w[r].status&&(b+='<div class="items"><div class="sku">'+w[r].id+'</div><div class="name">'+w[r].name+'</div><div class="pic">'+w[r].pic[0]+'</div><div class="num">1</div><div style="display:none" class="item_size_value">'+w[r].item_size+"</div></div>");d.is_valid||("undefined"!=typeof a.item_group[e].full_diff_money?g.find(".cl_words span.full_diff_money").text(concatParenttheses(a.item_group[e].full_diff_money)).show():g.find(".cl_words span.full_diff_money").text(formatUndefined(d.exten?d.exten:d.title)).show(),g.find(".cl_words span.full_diff_money").show(),g.find(".cl_words .selectBonus").remove()),d.is_valid?(g.find(".cl_words > a").hide(),g.find(".cl_words span.full_diff_money").hide()):g.find(".cl_words > a").show();var x=!1;if(o.find(".hidden_gift_list_"+h).html(b),g.find(".cl_words_zp").length&&d.seleted_gift)g.find(".cl_words_zp").show(),g.find(".cl_words_zp .selectBonus").show();else if(g.find(".cl_words .selectBonus").length&&d.seleted_gift&&x)g.find(".cl_words .selectBonus").show();else if((a.item_group[e].promotion.seleted_gift||w.length>0)&&d.is_valid){var y=!1,k='<span class="cl_words_zp">';k+="<em>[赠品]</em>";var T=!1;if(w.length>0)for(r=0;r<w.length;r++)1==w[r].status&&w[r].id==d.seleted_gift&&(k+=w[r].name,y=!0),1==w[r].status&&(T=!0);if(T&&(k+='<a class="cart_zp_btn btn_xzzp selectBonus" data-pid="'+h+'"href="javascript:void(0)">'+(d.seleted_gift?"重新选择":"选择赠品")+"</a>"),k+="</span>",!y&&a.item_group[e].promotion.seleted_gift||!T){var k='<span class="cl_words_zp">';k+="<em>[赠品]</em>(已赠完)</span>"}g.find(".cl_words").append(k)}else g.find(".cl_words .cl_words_zp").remove()}else"undefined"!=typeof a.item_group[e].full_diff_money?g.find(".cl_words span.full_diff_money").text(concatParenttheses(a.item_group[e].full_diff_money)).show():g.find(".cl_words span.full_diff_money").text(formatUndefined(d.exten?d.exten:d.title)).show(),d.is_valid?g.find(".cl_words > a").hide():g.find(".cl_words > a").show()}}}),changetotalheight(),!0}return!1}})}function cartTips(t,e,i){function a(){return $(t.target).offset().left-n.width()/2}var o=4e3;$(".checkTipsErr").remove(),$(".checkTips").remove();var n;"err"==e?_class="checkTipsErr":_class="checkTips",t&&($("<p />").addClass(_class).css({opacity:0}).html(i).appendTo($("body")).append('<i class="arr" />'),n="err"==e?$(".checkTipsErr"):$(".checkTips"),n.css({top:$(t.target).offset().top,left:a(),"z-index":9999,"margin-left":0}).animate({opacity:1,top:"-=30"},100).delay(o).animate({opacity:0},500,function(){$(this).remove()}))}function cartbehindTips(t,e,i){function a(){return $(t.target).offset().left-n.width()/2}var o=4e3;$(".checkTipsErr").remove(),$(".checkTips").remove();var n;"err"==e?_class="checkTipsErr":_class="checkTips",t&&($("<p />").addClass(_class).css({opacity:0}).html(i).appendTo($("body")).append('<i class="arr" />'),n="err"==e?$(".checkTipsErr"):$(".checkTips"),n.css({top:$(t.target).offset().top,left:a(),"z-index":9999,"margin-left":0}).animate({opacity:1,top:"+=30"},100).delay(o).animate({opacity:0},500,function(){$(this).remove()}))}function changeBtmFixed(){var t=$(window).scrollTop();t+winH<_btmheight+_btmtop?$btm.hasClass("fixed_c_count")||$btm.addClass("fixed_c_count"):$btm.removeClass("fixed_c_count")}function dialog_mid(t){var e='<div id="confirmDiv" style="width: 367px; height: auto; padding:0 0 20px 0; left: 50%; top: 50%; margin: -87px 0px 0px -183px; position: fixed;z-index:10000">                    <div class="dialogTit">                        <p></p>                        <p class="msg" style="padding-top: 43px; padding-bottom: 33px; font-size:14px; line-height:1.5;">'+t+'</p>                        <p class="ops"><span class="ok">确定</span></p>                    </div>                </div>                <div id="confirmDivBack" style="background:rgba(0,0,0,0.5);width:100%;height:100%;position:fixed;z-index:2999;left:0;top:0"></div>';$("body").append(e),$("#confirmDiv .ok").click(function(){$("#confirmDiv").remove(),$("#confirmDivBack").remove()}),$("#confirmDiv .cancel").click(function(t){$("#confirmDiv").remove(),$("#confirmDivBack").remove()})}var $btm=$("#cashier_part");if($btm.length>0)var _btmheight=$btm.height(),winH=$(window).height(),_btmtop=$btm.position().top,warehouse_id=0,popNotShow=0;$(function(){$("#arrowr").click(function(){scrollwrap("right")}),$("#arrowl").click(function(){scrollwrap("left")})}),$(document).ready(function(){var t={init:function(){this.$mask=$(".popBg"),this.$shui=$(".popShui")},show:function(){this.$mask.show();var t=this.$shui.width(),e=this.$shui.height();this.$shui.css({"margin-top":-e/2+"px","margin-left":-t/2+"px"}).show()},hide:function(){this.$mask.hide(),this.$shui.hide()}};t.init(),$tipsDelay=5500,_min=1,_max=99,$(".cashier_part").delegate(".btnJieSuan","click",function(t){warehouse_id=$(this).attr("data-warehouse"),$("#taxes_price_"+warehouse_id).length&&(taxes_price=parseFloat($("#taxes_price_"+warehouse_id).text().replace("¥",""))),formSubmit(t),t.preventDefault()}),$("body").delegate("#shopping_cart .selectBonus","click",function(t){t.preventDefault();var e="",i=$(this),a=i.attr("data-pid"),o=$(".hidden_gift_list_"+a+" .items");if(o.length>0){e='<div id="popWin" class="bounsPop"><div class="bounslist" style="height: 230px;overflow-y: auto;"><table><tbody>';var n=[];o.each(function(){var t=$(this),e={pid:a,sku:t.find(".sku").text(),name:t.find(".name").text(),pic:t.find(".pic").text(),num:t.find(".num").text(),item_size:t.find(".item_size_value").text()};n.push(e)});for(var s=0;s<n.length;s++){var d=n[s];e+='<tr><td class="ck"><input type="radio" name="gifts_'+d.pid+'" value="'+d.sku+'"></td><td class="img"><img src="'+d.pic+'" alt=""></td><td><p>'+d.name+"<br>"+d.num+' 件</p></td><td style="display:none" class="item_size"><div>'+d.item_size+"</div></td></tr>"}e+='</tbody></table></div><div class="opline"><a href="#" class="okdiabled" data-pid="'+a+'">确定</a><a href="#" class="cancel">取消</a></div></div>',$("#dialog").html(e),$("#dialog").dialog({autoOpen:!0,closeOnEscape:!0,modal:!0,width:450,draggable:!1,resizable:!1,position:"center"}).dialog("open")}else cartTips(t,"err","已赠完");return!1}),$("body").delegate('.bounsPop input[type="radio"]',"click",function(t){$(".bounsPop .okdiabled").removeClass("okdiabled").addClass("ok")}),$("body").delegate(".bounsPop .okdiabled","click",function(t){t.preventDefault(),cartTips(t,"err","请选择赠品")}),$("body").delegate(".bounsPop .ok","click",function(t){t.preventDefault();var e=$(this),i={pid:e.data("pid"),product:$('.bounsPop input[type="radio"]:checked').val(),row_id:e.data("rowid"),warehouse_id:e.data("warehouse_id"),item_size:$('.bounsPop input[type="radio"]:checked').parent().parent().find(".item_size div").html()};$.ajax({url:"/instant/cart/chooseGift",type:"POST",dataType:"json",data:i,success:function(e){1==e.code?(w_p=$('#shopping_cart .cl_tit[data-promotion="'+e.pid+'"]'),w_p.find(".cl_words > .selectBonus").hide(),w_p.find(".cl_words_zp").length?w_p.find(".cl_words_zp").html("<em>[赠品]</em>"+e.gift_name+'<a href="javascript:void(0)" class="cart_zp_btn btn_xzzp selectBonus" data-pid="'+e.pid+'">重新选择</a>'):(zp='<span class="cl_words_zp" >',zp+="<em>[赠品]</em>"+e.gift_name,zp+='<a class="cart_zp_btn btn_xzzp selectBonus" href="javascript:void(0)" data-pid="'+e.pid+'">重新选择</a>',zp+="</span>",w_p.find(".cl_words").append(zp)),$("#dialog").dialog("close")):cartTips(t,"err",e.msg)}})}),$("body").delegate(".bounsPop .cancel","click",function(t){t.preventDefault(),$("#dialog").dialog("close")}),$("#shopping_cart .modity").click(function(t){t.preventDefault();var e,i=$(t.target).offset().top+27,a=$(t.target).offset().left-264,o=$(this),n=o.attr("data-opid"),s=(o.closest("tr"),o.closest(".gooditem").find(".mck").val()),d=$(".hidden_promotion_list_"+s+" .item");if(d.length>0){for(var r=[],c=0;c<d.length;c++){var l=d.eq(c),p={id:l.find(".promotion_id").text(),title:l.find(".promotion_title").text()};r.push(p)}for(var e='<span class="arr"></span><div class="conn"><p class="promotionP"><b>活动优惠：</b><select name="promotionSelector" id="promotionSelector">',c=0;c<r.length;c++)e+=r[c].id==n?'<option selected value="'+r[c].id+'">'+r[c].title+"</option>":'<option value="'+r[c].id+'">'+r[c].title+"</option>";e+='</select></p></div><div class="opline"><a href="#" class="ok" data-opid="'+n+'" data-rowid="'+s+'" >确定</a><a href="#" class="cancel">取消</a></div>',$("#promotionLists").show().css({top:i,left:a}).show().empty().html(e)}else cartTips(t,"err","暂无优惠");return!1}),$("body").delegate("#promotionLists .ok","click",function(t){t.preventDefault();var e=$(this),i={pid:$("#promotionSelector").val(),row_id:e.data("rowid"),opid:e.data("opid")};i.pid!=i.opid?jQuery.ajax({url:"/instant/cart/getPromotionInfoByParams",type:"POST",dataType:"json",data:i,success:function(e){if(1==e.code){return window.location.reload()}else cartTips(t,"err",e.msg)}}):$("#promotionLists").hide()}),$("body").delegate("#promotionLists .cancel","click",function(t){t.preventDefault(),$("#promotionLists").hide()}),changeBtmFixed(),$(window).on("scroll",function(){changeBtmFixed()}),$("#shopping_cart .delete").confirm({msg:"确定要删除该商品么？",modal:!0,onOK:function(t){var e=$(t.target),i=[];i[0]=e.closest(".gooditem").find(".mck").val(),opid=e.closest(".cl_con").data("pid");var a={target:t,rowid:i,opid:opid};partDelete(a)},onCancel:function(){}}),$("#shopping_cart .dp_jia").click(function(t){t.preventDefault();var e=$(this),i=e.closest(".it_num").find(".dp_num"),a=Math.abs(parseInt(i.val())),o=e.data("max");if(a++,count=1,o&&a>o)return cartbehindTips(t,"err","超出最大购买限制"),!0;if(a>99)return cartTips(t,"err","商品数量必须大于1同时小于99"),!0;var n=(e.closest(".gooditem"),e.closest(".gooditem").find(".it_mck .mck").attr("cart-sku")),s=i.attr("warehouse_id"),d=e.closest(".gooditem").find(".it_size").text(),r=e.data("fm"),c=e.closest(".gooditem").find(".it_mck .mck").val();d||(d="SINGLE");var l={id:n,count:count,num:a,size:d,ref:r,row_id:c,warehouse_id:parseInt(s),opid:e.closest(".cl_con").data("pid")};e.closest(".cl_con").data("pid")||(l.opid=0),changeNum(i,l,t)}),$("#shopping_cart .dp_jian").click(function(t){t.preventDefault();var e=$(this),i=e.closest(".it_num").find(".dp_num"),a=Math.abs(parseInt(i.val()));if(a--,count=-1,a<1)return cartTips(t,"err","商品数量必须大于1同时小于99"),!0;var o=(e.closest(".gooditem"),e.closest(".gooditem").find(".it_mck .mck").attr("cart-sku")),n=i.attr("warehouse_id"),s=e.closest(".gooditem").find(".it_size").text(),d=e.data("fm"),r=e.closest(".gooditem").find(".it_mck .mck").val();s||(s="SINGLE");var c={id:o,count:count,num:a,size:s,ref:d,row_id:r,warehouse_id:parseInt(n),opid:e.closest(".cl_con").data("pid")};e.closest(".cl_con").data("pid")||(c.opid=0),changeNum(i,c,t)}),$("#combination").delegate(".addToCart","click",function(t){t.preventDefault();var e=$(this).data("id");addToCart(e,t)}),$(".removeAll").confirm({msg:"确定要删除已选中商品吗？",modal:!0,before:function(t){$(t.target);if(0==$(".c_list").find('input[name="productcheck"]').length)return cartTips(t,"err","请选择要删除的商品！"),!1},onOK:function(t){var e=($(t.target),[]);$(".c_list").find('input[name="productcheck"]').each(function(){$(this).prop("checked")&&e.push($(this).val())});var i={target:t,rowid:e};partDelete(i)}}),$(".removeFail").confirm({msg:"确定要删除失效的商品吗？",tit:"删除失效商品",before:function(t){if(0==$(".gooditem[failrowid]").length)return cartTips(t,"err","没有已失效的商品！"),!1},onOK:function(t){var e=($(t.target),[]);$("#shopping_cart .gooditem[failrowid]").each(function(){e.push($(this).attr("failrowid"))});var i={target:t,rowid:e};partDelete(i)}}),$(".batchAddMine").confirm({msg:"确定将选中的商品移入收藏夹吗？",tit:"移入收藏夹",before:function(t){$(t.target);if(0==$(".c_list").find('input[name="productcheck"]:checked').length)return cartTips(t,"err","请选择要移入收藏夹的商品！"),!1},onOK:function(t){var e=($(t.target),[]),i=[];$(".c_list").find('input[name="productcheck"]').each(function(){$(this).prop("checked")&&(e.push($(this).attr("cart-sku")),i.push($(this).val()))});var a={target:t,rowid:i};$.ajax({url:"/instant/collect/ajaxBatchAddMine",type:"POST",dataType:"json",data:{item_id:e,row_id:i},success:function(e){e.res&&partDelete(a),cartTips(t,"err",e.data)}})}})}),$(".midou_dikou").on("click",".midou_btn",function(t){var e=$(this),i=e.closest(".gooditem"),a=e.attr("data-isu"),o=i.find(".goodsp"),n=i.find(".item_fee"),s=i.find(".it_mck .mck").attr("cart-sku"),d=i.find(".it_size").text(),r=i.find(".it_mck .mck").val(),c=i.find(".dp_num").val();d||(d="SINGLE");var l=i.find(".it_num").attr("buy_type");if(0==a){0==l&&(l=1),2==l&&(l=3);var p={id:s,size:d,num:c,row_id:r,buy_type:l};$.ajax({url:"/instant/cart/use_mibean_offset_price",type:"POST",dataType:"json",data:p,success:function(t){1==t.code?(i.find(".it_num").attr("buy_type",l),e.attr({"class":"midou_btn btn_1","data-isu":"1"}).text("已使用"),o.text((t.subtotal/t.stock).toFixed(2)),n.text("￥"+t.subtotal),changeTotal(r)):dialog_mid(t.msg)}})}else{1==l&&(l=0),3==l&&(l=2);var p={id:s,size:d,num:c,row_id:r,buy_type:l};$.ajax({url:"/instant/cart/cancel_use_mibean_offset_price",type:"POST",dataType:"json",data:p,success:function(t){switch(t.code){case 1:i.find(".it_num").attr("buy_type",l),e.attr({"class":"midou_btn","data-isu":"0"}).text("使用抵扣"),o.text((t.subtotal/t.stock).toFixed(2)),n.text("￥"+t.subtotal),changeTotal(r);break;default:console.log("--")}}})}});